# mathcha2tikz

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Status](https://img.shields.io/badge/Status-MVP-green.svg)]()


Convert Mathcha-exported TikZ into clean, optimized TikZ. Supports multiple shapes, styles, and two output modes (Classic, Obsidian), with post-processing for colors, opacity, and dash patterns. Obsidian is the default output mode.

![alt text](<docs/screenshots/Screenshot 2025-10-05 at 01.31.06.png>)

## Important Notice

**AI-Generated Code Warning**: This project contains code generated by AI tools (DeepSeek, ChatGPT by Cursor and Windsurf) for boilerplate, structure, and documentation. However, the **core mathematical logic, algorithms, and main conversion logic were developed manually** to ensure accuracy and reliability. 

## Quick Start

```bash
# Install
pip install -r requirements.txt

# CLI (interactive clipboard flow included)
python -m mathcha2tikz.cli        # preferred (package-aware)
# or
python mathcha2tikz/cli.py        # direct script (supported)

# Python API
python -c "from core.main import convert; print(convert('\\draw (0,0)--(1,1);', mode='classic'))"
```

## Examples
![alt text](<docs/screenshots/Screenshot 2025-10-05 at 01.00.01.png>)
Here are some realworld examples rendered in Obsidian mode:
<details>
<summary> Light mode </summary>

![alt text](<docs/screenshots/Screenshot 2025-10-05 at 15.01.11.png>)
![alt text](<docs/screenshots/Screenshot 2025-10-05 at 15.02.13 1.png>)

</details>

<details>
<summary> Dark mode </summary>

![alt text](<docs/screenshots/Screenshot 2025-10-05 at 15.10.45.png>)
![alt text](<docs/screenshots/Screenshot 2025-10-05 at 15.10.32.png>)

</details>

## Output Modes

- Obsidian (default): active preamble + document wrapper. Use with Obsidian via `TikZJaX` plugin.
- Classic: commented preamble hints + tikzpicture. Use with any LaTeX editor.

Use `--mode classic` to switch.

## Features (current)

- Shapes: Straight Lines, Curve Lines, Arc, Ellipse/Circle
- Arrows: start/end, mid-arrows via decorations
- Styles:
  - Colors: post-processing via K-D tree for color search with O(log n) performance
  - Opacity post-processing (removes draw opacity=1, preserves others)
  - DashPattern post-processing (normalize, dedupe, exact-name conversion via dictionary)

## Architecture

The converter is broken into a modular pipeline (`Parser → Detector → Processor → Renderer → PostProcessor`).

- **CLI split**: `mathcha2tikz/cli.py` (entry), `mathcha2tikz/cli_io.py` (clipboard/stdin/editor), `mathcha2tikz/commands.py` (convert commands), `mathcha2tikz/cli_menus.py` (interactive menus).
- **Lazy bootstrap**: processor and renderer registries are initialized on demand (`ensure_builtin_processors_registered()` / `ensure_builtin_renderers_registered()`), minimizing import side-effects and keeping CLI startup fast.
- **Strict error handling**: processing/renderer stages raise `ProcessingError` / `RenderingError` on failures instead of hiding warnings, surfacing actionable diagnostics.
- **Template engine**: output modes (`classic`, `obsidian`) are defined in `core/templates.py` via immutable template constants with dedicated post-processing.

See `docs/WORKFLOW.md` for a deeper dive into the pipeline, typing contracts (`ShapePayload`), and extension points.

## CLI Flags

- `--mode {classic,obsidian}`: choose output mode (default: obsidian)
- `--input-method {clipboard,paste,editor}`: quick-convert input source
- `--debug`: enable debug logging
- `--no-copy`: do not copy output to clipboard after conversion

## Roadmap

- Auto-positioning of nodes
- More shapes: snake, wave (prototypes ready; to be wired into pipeline)
- Richer styles: pattern and fill
- Dash patterns: extend dictionary; future nearest-match mapping when no exact match

## Known Limitations

- Module toggles and pipeline configuration menus are hidden for now
- Per-module debug UI is hidden; only global debug toggle is available
- Occasional instability; updates are infrequent

## Acknowledgements

- Special thanks to https://latexcolor.com/ for the LaTeX color table (≈700 colors) used in this project.

## Contributing & License

Contributions are welcome and appreciated. MIT License.
